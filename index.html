<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Runner com Estilo</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
    #joystick-container {
      position: absolute;
      bottom: 30px;
      left: 30px;
    }
  </style>
</head>
<body>
  <div id="joystick-container"></div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>

  <script>
    let scene = new THREE.Scene();
    scene.background = new THREE.Color(0x87ceeb);

    let camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 10);

    let renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    let ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
    scene.add(ambientLight);

    let directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(5, 10, 5);
    scene.add(directionalLight);

    // Chão com textura
    const loader = new THREE.TextureLoader();
    const groundTexture = loader.load('https://threejsfundamentals.org/threejs/resources/images/checker.png');
    groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
    groundTexture.repeat.set(20, 20);

    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(100, 100),
      new THREE.MeshStandardMaterial({ map: groundTexture })
    );
    ground.rotation.x = -Math.PI / 2;
    scene.add(ground);

    // Personagem mais bonito (esfera com cilindro tipo boneco)
    let player = new THREE.Group();

    const body = new THREE.Mesh(
      new THREE.CylinderGeometry(0.5, 0.5, 1.5, 32),
      new THREE.MeshStandardMaterial({ color: 0x0099ff })
    );

    const head = new THREE.Mesh(
      new THREE.SphereGeometry(0.4, 32, 32),
      new THREE.MeshStandardMaterial({ color: 0xffcc99 })
    );
    head.position.y = 1.2;

    player.add(body);
    player.add(head);
    player.position.y = 0.75;
    scene.add(player);

    // Árvores simples
    function addTree(x, z) {
      const trunk = new THREE.Mesh(
        new THREE.CylinderGeometry(0.2, 0.2, 1),
        new THREE.MeshStandardMaterial({ color: 0x8b4513 })
      );
      trunk.position.set(x, 0.5, z);

      const leaves = new THREE.Mesh(
        new THREE.SphereGeometry(0.7, 16, 16),
        new THREE.MeshStandardMaterial({ color: 0x228B22 })
      );
      leaves.position.set(x, 1.5, z);

      scene.add(trunk);
      scene.add(leaves);
    }

    // Adiciona árvores nos lados
    for (let i = -40; i <= 40; i += 10) {
      addTree(-5, i);
      addTree(5, i);
    }

    // Joystick
    const joystick = nipplejs.create({
      zone: document.getElementById("joystick-container"),
      mode: "static",
      position: { left: "60px", bottom: "60px" },
      color: "black"
    });

    let moveX = 0, moveZ = 0;

    joystick.on("move", (evt, data) => {
      const angle = data.angle.radian;
      const speed = 0.15;
      moveX = Math.cos(angle) * speed;
      moveZ = Math.sin(angle) * speed;
    });

    joystick.on("end", () => {
      moveX = 0;
      moveZ = 0;
    });

    function animate() {
      requestAnimationFrame(animate);
      player.position.x += moveX;
      player.position.z += moveZ;

      // A câmera segue o jogador
      camera.position.x = player.position.x;
      camera.position.z = player.position.z + 10;
      camera.lookAt(player.position);

      renderer.render(scene, camera);
    }

    animate();

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>