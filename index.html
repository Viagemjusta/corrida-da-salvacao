<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Purificador Microscópico</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas { display: block; background: #0d0d0d; margin: 0 auto; }
    #joystick {
      position: absolute; bottom: 20px; left: 20px;
      width: 100px; height: 100px; background: rgba(255,255,255,0.05);
      border-radius: 50%; touch-action: none;
    }
    #stick {
      width: 40px; height: 40px; background: #0ff;
      border-radius: 50%; position: absolute; top: 30px; left: 30px;
    }
  </style>
</head>
<body>
<canvas id="game" width="360" height="600"></canvas>
<div id="joystick"><div id="stick"></div></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const player = { x: 160, y: 500, size: 20, speed: 2 };
const viruses = [];
let score = 0;
let health = 3;

function drawPlayer() {
  ctx.fillStyle = "#0ff";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
  ctx.fill();
}

function spawnVirus() {
  viruses.push({
    x: Math.random() * (canvas.width - 20) + 10,
    y: -20,
    size: 15,
    speed: 1 + Math.random() * 2
  });
}

function drawViruses() {
  ctx.fillStyle = "red";
  viruses.forEach(v => {
    ctx.beginPath();
    ctx.arc(v.x, v.y, v.size, 0, Math.PI * 2);
    ctx.fill();
    v.y += v.speed;
  });
}

function checkCollisions() {
  viruses.forEach((v, i) => {
    const dx = v.x - player.x;
    const dy = v.y - player.y;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < v.size + player.size) {
      viruses.splice(i, 1);
      score += 1;
    } else if (v.y > canvas.height) {
      viruses.splice(i, 1);
      health -= 1;
    }
  });
}

function drawHUD() {
  ctx.fillStyle = "#fff";
  ctx.font = "16px Arial";
  ctx.fillText("Pontuação: " + score, 10, 20);
  ctx.fillText("Vida: " + health, 10, 40);
}

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPlayer();
  drawViruses();
  checkCollisions();
  drawHUD();

  if (health <= 0) {
    ctx.fillStyle = "white";
    ctx.font = "24px Arial";
    ctx.fillText("GAME OVER", 100, 300);
    return;
  }

  requestAnimationFrame(loop);
}

setInterval(spawnVirus, 1000);

// Joystick
let stick = document.getElementById("stick");
let joyStartX = 0, joyStartY = 0, dragging = false;

document.getElementById("joystick").addEventListener("touchstart", e => {
  dragging = true;
  joyStartX = e.touches[0].clientX;
  joyStartY = e.touches[0].clientY;
});

document.getElementById("joystick").addEventListener("touchmove", e => {
  if (!dragging) return;
  let dx = e.touches[0].clientX - joyStartX;
  let dy = e.touches[0].clientY - joyStartY;
  stick.style.transform = `translate(${dx}px, ${dy}px)`;

  player.x += dx * 0.1;
  player.y += dy * 0.1;

  // Limites
  player.x = Math.max(player.size, Math.min(canvas.width - player.size, player.x));
  player.y = Math.max(player.size, Math.min(canvas.height - player.size, player.y));

  joyStartX = e.touches[0].clientX;
  joyStartY = e.touches[0].clientY;
});

document.getElementById("joystick").addEventListener("touchend", () => {
  dragging = false;
  stick.style.transform = `translate(0, 0)`;
});

loop();
</script>
</body>
</html>