<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Guardiões da Rua</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    canvas { background: #111; display: block; margin: 0 auto; }
    #joystick {
      position: absolute; bottom: 20px; left: 20px;
      width: 100px; height: 100px;
      background: rgba(255,255,255,0.1);
      border-radius: 50%; touch-action: none;
    }
    #stick {
      width: 40px; height: 40px;
      background: white; border-radius: 50%;
      position: absolute; top: 30px; left: 30px;
    }
    #fireBtn {
      position: absolute; bottom: 40px; right: 30px;
      width: 60px; height: 60px; background: red;
      border-radius: 50%; border: none; color: white;
      font-weight: bold; font-size: 18px;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="360" height="600"></canvas>
<div id="joystick"><div id="stick"></div></div>
<button id="fireBtn">Fogo</button>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const player = { x: 150, y: 500, size: 30, speed: 3 };
const bullets = [];
const enemies = [];
let score = 0;

function drawPlayer() {
  ctx.fillStyle = "cyan";
  ctx.fillRect(player.x, player.y, player.size, player.size);
}

function drawBullets() {
  ctx.fillStyle = "yellow";
  bullets.forEach(b => {
    ctx.fillRect(b.x, b.y, 5, 10);
    b.y -= 5;
  });
}

function drawEnemies() {
  ctx.fillStyle = "crimson";
  enemies.forEach(e => {
    ctx.fillRect(e.x, e.y, e.size, e.size);
    e.y += 2;
  });
}

function checkCollisions() {
  bullets.forEach((b, bi) => {
    enemies.forEach((e, ei) => {
      if (b.x < e.x + e.size && b.x + 5 > e.x && b.y < e.y + e.size && b.y + 10 > e.y) {
        enemies.splice(ei, 1);
        bullets.splice(bi, 1);
        score += 10;
      }
    });
  });
}

function gameOver() {
  enemies.forEach(e => {
    if (
      player.x < e.x + e.size &&
      player.x + player.size > e.x &&
      player.y < e.y + e.size &&
      player.y + player.size > e.y
    ) {
      alert("Game Over! Pontuação: " + score);
      location.reload();
    }
  });
}

function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPlayer();
  drawBullets();
  drawEnemies();
  checkCollisions();
  gameOver();
  ctx.fillStyle = "white";
  ctx.fillText("Pontuação: " + score, 10, 20);
  requestAnimationFrame(loop);
}

setInterval(() => {
  enemies.push({
    x: Math.random() * (canvas.width - 30),
    y: -30,
    size: 30
  });
}, 1000);

// Controle com joystick
let joystick = document.getElementById("joystick");
let stick = document.getElementById("stick");

let dragging = false, joyStartX = 0, joyStartY = 0;

joystick.addEventListener("touchstart", e => {
  dragging = true;
  joyStartX = e.touches[0].clientX;
  joyStartY = e.touches[0].clientY;
});

joystick.addEventListener("touchmove", e => {
  if (!dragging) return;
  let dx = e.touches[0].clientX - joyStartX;
  let dy = e.touches[0].clientY - joyStartY;
  stick.style.transform = `translate(${dx}px, ${dy}px)`;

  // Mover jogador
  player.x += dx * 0.05;
  player.y += dy * 0.05;

  // Limites
  player.x = Math.max(0, Math.min(canvas.width - player.size, player.x));
  player.y = Math.max(0, Math.min(canvas.height - player.size, player.y));

  joyStartX = e.touches[0].clientX;
  joyStartY = e.touches[0].clientY;
});

joystick.addEventListener("touchend", () => {
  dragging = false;
  stick.style.transform = `translate(0, 0)`;
});

// Botão de tiro
document.getElementById("fireBtn").addEventListener("click", () => {
  bullets.push({
    x: player.x + player.size / 2 - 2,
    y: player.y
  });
});

loop();
</script>
</body>
</html>