<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Corrida da Salvação</title>
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    body {
      background: linear-gradient(to top, #87CEEB, #ffffff);
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    canvas {
      background-color: #fff;
      border: 4px solid #333;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let personagem = new Image();
    personagem.src = "https://github.com/Viagemjusta/corrida-da-salvacao/blob/main/photo-output.png?raw=true";

    let personagemX = 50;
    let personagemY = 300;
    let personagemW = 50;
    let personagemH = 50;
    let velocidadeY = 0;
    let gravidade = 1.5;
    let pulando = false;

    let obstaculoX = 800;
    let obstaculoW = 30;
    let obstaculoH = 60;

    let jogoAtivo = true;
    let pontuacao = 0;

    function desenharPersonagem() {
      ctx.drawImage(personagem, personagemX, personagemY, personagemW, personagemH);
    }

    function desenharObstaculo() {
      ctx.fillStyle = "#8B0000";
      ctx.fillRect(obstaculoX, 340, obstaculoW, obstaculoH);
    }

    function atualizar() {
      if (!jogoAtivo) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = "#228B22";
      ctx.fillRect(0, 350, canvas.width, 50);

      ctx.fillStyle = "#000";
      ctx.font = "18px Arial";
      ctx.fillText("Pontuação: " + pontuacao, 20, 30);

      desenharPersonagem();
      desenharObstaculo();

      obstaculoX -= 6;
      if (obstaculoX + obstaculoW < 0) {
        obstaculoX = 800 + Math.random() * 300;
        pontuacao++;
      }

      personagemY += velocidadeY;
      velocidadeY += gravidade;

      if (personagemY > 300) {
        personagemY = 300;
        velocidadeY = 0;
        pulando = false;
      }

      // Colisão
      if (
        personagemX < obstaculoX + obstaculoW &&
        personagemX + personagemW > obstaculoX &&
        personagemY + personagemH > 340
      ) {
        jogoAtivo = false;
        ctx.fillStyle = "#000";
        ctx.font = "30px Arial";
        ctx.fillText("Fim de jogo! Toque ou clique para reiniciar.", 150, 200);
      }

      requestAnimationFrame(atualizar);
    }

    function pularOuReiniciar() {
      if (!pulando && jogoAtivo) {
        velocidadeY = -20;
        pulando = true;
      } else if (!jogoAtivo) {
        reiniciarJogo();
      }
    }

    function reiniciarJogo() {
      personagemY = 300;
      velocidadeY = 0;
      obstaculoX = 800;
      pontuacao = 0;
      jogoAtivo = true;
      atualizar();
    }

    // TOQUE (celular)
    window.addEventListener("touchstart", pularOuReiniciar);

    // CLIQUE (mouse)
    window.addEventListener("mousedown", pularOuReiniciar);

    // TECLA (barra de espaço)
    window.addEventListener("keydown", function(e) {
      if (e.code === "Space") {
        pularOuReiniciar();
      }
    });

    personagem.onload = () => {
      atualizar();
    };
  </script>
</body>
</html>